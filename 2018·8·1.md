# 甘肃删除多余数据的sql-只保留一条

## 教程

- 1、查找表中多余的重复记录，重复记录是根据单个字段（peopleId）来判断 

```sql
select * from people  where peopleId in (select peopleId from people group by peopleId having count(peopleId) > 1) ;
```

- 2、删除表中多余的重复记录，重复记录是根据单个字段（peopleId）来判断，只留有rowid最小的记录

```sql
delete from people where   peopleName in (select peopleName    from people group by peopleName      having count(peopleName) > 1) and   peopleId not in (select min(peopleId) from people group by peopleName     having count(peopleName)>1) ;
```

- 3、查找表中多余的重复记录(多个字段)

```sql
select * from vitae a where (a.peopleId,a.seq) in (select peopleId,seq from vitae group by peopleId,seq having count(*) > 1);
```

- 4、删除表中多余的重复记录（多个字段），只留有rowid最小的记录

```sql
delete from vitae a where (a.peopleId,a.seq) in (select peopleId,seq from vitae group by peopleId,seq having count(*) > 1) and rowid not in (select min(rowid) from vitae group by peopleId,seq having count(*)>1);
```

## 甘肃重复数据的sql

- 根据多个字段判断重复数据

### 根据校验程序反馈表查询重复数据

```sql
--查询条件
 where t.personal_id in
       (select t1.personal_id
          from t_inv_personal_resp@qianzhi29 t1
         where t1.res_msg like 'single selection error%')
 order by t.personal_id;
   --for update;
```

### 测试表：ZXDC_ACCESSIABLE_REMOULD_REQ

```sql
--所有重复的数据
select *
  from ZXDC_ACCESSIABLE_REMOULD_REQ t
 where (t.personal_id, t.accessiable_remould_req) in
       (select personal_id, accessiable_remould_req
          from ZXDC_ACCESSIABLE_REMOULD_REQ
         group by personal_id, accessiable_remould_req
        having count(*) > 1)
   and t.personal_id in
       (select t1.personal_id
          from t_inv_personal_resp@qianzhi29 t1
         where t1.res_msg like 'single selection error%');

--只留唯一一条数据
select *
  from ZXDC_ACCESSIABLE_REMOULD_REQ t
 where (t.personal_id, t.accessiable_remould_req) in
       (select personal_id, accessiable_remould_req
          from ZXDC_ACCESSIABLE_REMOULD_REQ
         group by personal_id, accessiable_remould_req
        having count(*) > 1)
   and t.personal_id in
       (select t1.personal_id
          from t_inv_personal_resp@qianzhi29 t1
         where t1.res_msg like 'single selection error%')
   and rowid not in (select min(rowid)
                       from ZXDC_ACCESSIABLE_REMOULD_REQ
                      group by personal_id, accessiable_remould_req
                     having count(*) > 1) for update;
```

## 查询模板

- table_name为表明，可以直接替换表明
- row1为第一个字段，甘肃项目可以直接改成personal_id
- row2为第二个字段，根据不同的表进行选择

```sql
select *
  from table_name t
 where (t.row1, t.row2) in (select row1, row2
                              from table_name
                             group by row1, row2
                            having count(*) > 1)
   and rowid not in (select min(rowid)
                       from table_name
                      group by row1, row2
                     having count(*) > 1)
   and t.row1 in
       (select t1.personal_id
          from t_inv_personal_resp@qianzhi29 t1
         where t1.res_msg like 'single selection error%')
   for update;
```

## 删除sql模板

```sql
-- 多条校验
--模板表-zxdc_rehabilitation_req
create table zxdc_rehabilitation_req_1 as select t.*
          from zxdc_rehabilitation_req t
         where (t.personal_id, t.rehabilitation_req) in
               (select personal_id, rehabilitation_req
                  from zxdc_rehabilitation_req
                 group by personal_id, rehabilitation_req
                having count(*) > 1)
           and rowid not in (select min(rowid)
                               from zxdc_rehabilitation_req
                              group by personal_id, rehabilitation_req
                             having count(*) > 1)
           and t.personal_id in
               (select t1.personal_id
                  from t_inv_personal_resp@qianzhi29 t1
                 where t1.res_msg like 'single selection error%');
delete from zxdc_rehabilitation_req o
 where o.uuid in
       (select t.uuid
          from zxdc_rehabilitation_req t
         where (t.personal_id, t.rehabilitation_req) in
               (select personal_id, rehabilitation_req
                  from zxdc_rehabilitation_req
                 group by personal_id, rehabilitation_req
                having count(*) > 1)
           and rowid not in (select min(rowid)
                               from zxdc_rehabilitation_req
                              group by personal_id, rehabilitation_req
                             having count(*) > 1)
           and t.personal_id in
               (select t1.personal_id
                  from t_inv_personal_resp@qianzhi29 t1
                 where t1.res_msg like 'single selection error%'))
--单条校验
--模板表-zxdc_personal_fralture
create table zxdc_personal_fralture_1 as select t.*
          from zxdc_personal_fralture t
         where t.personal_id in
               (select personal_id
                  from zxdc_personal_fralture
                 group by personal_id
                having count(*) > 1)
           and rowid not in (select min(rowid)
                               from zxdc_personal_fralture
                              group by personal_id
                             having count(*) > 1)
           and t.personal_id in
               (select t1.personal_id
                  from t_inv_personal_resp@qianzhi29 t1
                 where t1.res_msg like 'single selection error%');
delete from zxdc_personal_fralture o
 where o.uuid in
       (select t.uuid
          from zxdc_personal_fralture t
         where t.personal_id in
               (select personal_id
                  from zxdc_personal_fralture
                 group by personal_id
                having count(*) > 1)
           and rowid not in (select min(rowid)
                               from zxdc_personal_fralture
                              group by personal_id
                             having count(*) > 1)
           and t.personal_id in
               (select t1.personal_id
                  from t_inv_personal_resp@qianzhi29 t1
                 where t1.res_msg like 'single selection error%'));
```

## 数据备份

- 是否需要数据备份，最多182条

- 未删除的表
> zxdc_eco_house
>
>zxdc_manager